define("bower_components/waterfall/pager",["require","zenjs/events"],function(e){var t=e("zenjs/events"),i=function(){};return t.extend({init:function(e){this.$el||(this.$el=$(e.el||e.$el||"<div></div>"),this.el=this.$el[0]),this.nLoading=e.loadingHTML?$(e.loadingHTML).addClass("loading-more"):$('<div class="loading-more"><span></span></div>'),this.nList=this.$el.find(".js-list"),0===this.nList.length&&(this.nList=$('<div class="js-list b-list"></div>'),this.$el.append(this.nList)),"number"==typeof e.total&&(this.total=e.total),this.offset=e.offset||300,this.scrollDirection="down",this.pageIndex=e.pageIndex||0,this.perPage=e.perPage||10,this.postData=e.postData||{},this.checkSize=!0,"boolean"==typeof e.checkSize&&(this.checkSize=e.checkSize),this.idName=e.idName||"id",e.idValue&&(this.idValue=e.idValue),this.jsonKeys=e.jsonKeys||{},this.finishedHTML=e.finishedHTML,this.finishedText=e.finishedText,this.emptyHTML=e.emptyHTML||"",this.emptyText=e.emptyText||"",this.getExtrPostData=e.getExtrPostData||i,this.onFetchError=e.onFetchError||i,this.onListEmpty=this.onListEmpty||e.onEmpty||this._onListEmpty,this.on("finished",e.onFinished||i),this.on("after:list:load",e.onAfterListLoad||e.onDataLoad||i),this.extraData={},this.scrollContainer=e.scrollContainer?$(e.scrollContainer):$("body"),this.scrollEventAccepter=e.scrollEventAccepter?$(e.scrollEventAccepter):$(e.scrollContainer||window),this._onScroll=$.proxy(this.onScroll,this),this.bindScrollFunc()},$:function(e){return this.$el.find(e)},onScroll:function(){function e(){var e=this.nList.offset(),t=this.scrollContainer.offset(),i={left:e.left-t.left||0,top:e.top-t.top||0};return i}return function(){if(!(this.sleeping||this.finished||this.fetching)){if(0===this.total||this.total&&this.total<=this.pageIndex*this.perPage)return void this.doFinishLoading();var t=e.call(this);"down"===this.scrollDirection&&this.nList.height()+t.top-this.scrollEventAccepter.height()-this.scrollContainer.scrollTop()<this.offset&&this.fetchMore&&this.fetchMore(),"up"===this.scrollDirection&&this.scrollContainer.scrollTop()<this.offset&&this.fetchMore&&this.fetchMore()}}}(),fetchMore:function(){return this.sleeping||this.finished||this.fetching?this:(this.showLoading(),this.fetching=!0,this._fetchMore&&this._fetchMore.call(this),this)},onFetchMoreSuccess:function(){this.hideLoading(),this.fetching=!1,this._onFetchMoreSuccess.apply(this,arguments)},fetchRender:function(){return this.fetchMore(),this},_onFetchMoreError:function(){this.fetching=!1,this.hideLoading(),this.onFetchError()},doFinishLoading:function(e){this.finished=!0,this.fetching=!1,this.hideLoading(),this.$el.find(".list-finished").remove(),this.triggerMethod&&this.triggerMethod("finished",this.collection,e)},bindScrollFunc:function(){var e=this;this.scrollFunc&&this.unbindScrollFunc(),this.scrollFunc=function(){e.scrollTimeout&&clearTimeout(e.scrollTimeout),e.scrollTimeout=setTimeout(e._onScroll,200)},this.scrollEventAccepter.on("scroll",this.scrollFunc)},unbindScrollFunc:function(){this.scrollEventAccepter.off("scroll",this.scrollFunc),this.scrollFunc=null},doSleep:function(){this.sleeping=!0,this.unbindScrollFunc()},doWake:function(){this.sleeping=!1,this.bindScrollFunc(),this.fetchMore()},showLoading:function(){this.hasFetching=!0,this.$el.append(this.nLoading)},hideLoading:function(){this.nLoading.remove()},getFinishHtml:function(){var e;return e=this.finishedHTML?$(this.finishedHTML).addClass("list-finished"):'<div class="list-finished">'+(this.finishedText||"已经没有更多了")+"</div>"},setExtraData:function(e){$.extend(this.extraData,e)},resetWaterfall:function(e){this.finished===!0&&this.$(".list-finished").remove(),this.removeAll&&this.removeAll(),this.nList.empty(),this.collection&&this.collection.reset([],{silent:!0}),this.listEl&&this.listEl.empty(),this.finished=!1,e&&e.pageIndex?this.pageIndex=e.pageIndex:this.pageIndex=0,this.idValue=void 0},_onListEmpty:function(){if(!this.fetching){var e;this.emptyHTML?e=$(this.emptyHTML).addClass("list-finished"):this.emptyText&&(e='<div class="list-finished">'+this.emptyText+"</div>"),this.$el.append(e)}},destroy:function(){this.doSleep(),this.$el.remove(),this.unbindScrollFunc()},remove:function(){this.destroy()}})}),define("zenjs/backbone/base_view",["require","backbone","../core/trigger_method"],function(e){var t=e("backbone"),i=e("../core/trigger_method");return t.View.extend({clean:function(){return this.stopListening(),this},triggerMethod:i})}),define("bower_components/zenlist/list",["require","exports","module","zenjs/backbone/base_view"],function(e,t,i){var n=function(){},o=e("zenjs/backbone/base_view");i.exports=o.extend({initialize:function(e){return this.options=e=e||{},this.items=[],this.itemView=e.itemView,this.itemOptions=e.itemOptions||{},this.collection=e.collection,this.onAfterListChange=e.onAfterListChange||n,this.onAfterListLoad=e.onAfterListLoad||n,this.onAfterListDisplay=e.onAfterListDisplay||n,this.onListEmpty=e.onListEmpty||e.onEmptyList||this._onListEmpty,this.onItemClick=e.onItemClick||n,this.onViewItemAdded=e.onViewItemAdded||n,this.displaySize=e.displaySize||-1,this.emptyHTML=e.emptyHTML||"",this.emptyText=e.emptyText||"列表为空",this},render:function(e){return this.displaySize=-1==(e||{}).displaySize?-1:this.displaySize,this.clean(),this._setupListeners(),this.addAll(),this.onAfterListDisplay({list:this.collection}),this},fetchRender:function(e){return this.collection.fetch({data:e,success:_(function(e,t){this.render(),this.onAfterListLoad(this.collection,t),this.onFetchSuccess&&this.onFetchSuccess()}).bind(this),error:_.bind(function(){this.onAfterListLoad(this.collection,response)},this)}),this},_setupListeners:function(){this.collection&&(this.stopListening(this.collection),this.listenTo(this.collection,"add",this.addItem,this),this.listenTo(this.collection,"reset sort",this.render,this),this.listenTo(this.collection,"remove",this.onItemRemoved,this))},addItemListeners:function(e){var t=this;this.listenTo(e,"all",function(){var t="item:"+arguments[0],i=_.toArray(arguments);i.splice(0,1),i.unshift(t,e),this.trigger.apply(this,i),"item:click"==t&&this.onItemClick()}),this.listenTo(e.model,"change",function(){t.onAfterListChange({list:this.collection})})},addAll:function(){0===this.collection.length?this.fetching||this.triggerMethod("list:empty"):this.collection.each(function(e){this.addItem(e)},this)},removeAll:function(){for(var e=this.items.length-1;e>=0;e--)this.removeView(this.items[e]);this.onAfterListChange({list:this.collection})},addItem:function(e,t,i){if(!(this.displaySize>=0&&this.items.length>=this.displaySize)){1==this.collection.length&&(this.listEl||this.$el).html("");var n=new this.itemView(_.extend({},this.options.itemOptions,{model:e,index:this.collection.indexOf(e)}));this.items.push(n),this.addItemListeners(n),n.render(),this.onViewItemAdded({list:this.items,viewItem:n,model:e});var o=(i||{}).at;return 0===o?(this.listEl||this.$el).prepend(n.el):(this.listEl||this.$el).append(n.el),n}},removeItem:function(e){var t=this.getViewByModel(e);t&&this.removeView(t)},removeView:function(e){var t;this.stopListening(e),e&&(this.stopListening(e.model),e.remove(),t=this.items.indexOf(e),this.items.splice(t,1)),0===this.collection.length&&(this.fetching||this.triggerMethod("list:empty"))},onItemRemoved:function(e){this.onAfterListChange({list:this.collection,action:"remove",model:e}),this.removeItem(e)},getViewByModel:function(e){return _.find(this.items,function(t,i){return t.model===e})},dispatchEventToAllViews:function(e,t){for(var i=this.items.length-1;i>=0;i--)this.items[i].trigger(e,t)},remove:function(){o.prototype.remove.call(this,arguments),this.removeAll(),this.collection.reset(),delete this.collection},clean:function(){o.prototype.clean.call(this,arguments),this.removeAll(),(this.listEl||this.$el).html(""),this.stopListening(this.collection)},_onListEmpty:function(){this.$el.html(this.emptyHTML||(this.emptyText?'<p style="text-align:center;line-height:60px;">'+this.emptyText+"</p>":""))}})}),define("bower_components/waterfall/waterfall",["require","./pager","bower_components/zenlist/list"],function(e){var t=e("./pager"),i=e("bower_components/zenlist/list"),n=function(){},o=t.extend({init:function(e){this._super(e),this.collection=e.collection,this.listEl=this.getListViewEl(),this.list=new i($.extend({},e,{el:this.listEl,collection:this.collection,onListEmpty:n})).render(),this.on("finished",this._doFinishLoading)},getListViewEl:function(){return this.nList},_fetchMore:function(){var e={};this.idValue&&(e[this.idName]=this.idValue),e[this.jsonKeys.perPage||"perpage"]=this.perPage,e[this.jsonKeys.pageIndex||"page"]=this.pageIndex+1;var t=this.getExtrPostData?this.getExtrPostData():{};this.collection.fetch({data:$.extend(e,this.postData,t,this.extraData),success:$.proxy(this.onFetchMoreSuccess,this),error:$.proxy(this.onFetchError,this),update:!0,remove:!1})},_onFetchMoreSuccess:function(e,t){this.pageIndex++,this.triggerMethod("after:list:load",{collection:e,response:t});var i=this.collection.parse(t);if(0===i.length||this.checkSize&&i.length<this.perPage)return void this.doFinishLoading();var n=_.last(this.collection.models);n&&(this.idValue=n.get(this.idName)),this.onScroll()},_onAfterListLoad:function(){var e=_.last(this.collection.models);e&&(this.idValue=e.get(this.idName))},_doFinishLoading:function(){if(this.collection.length>0){if(this.hasFetching&&this.pageIndex>1){var e=this.getFinishHtml();this.$el.append(e)}}else this.triggerMethod("list:empty")},addTopItem:function(e){this.collection.unshift(e)},addBottomItem:function(e){this.finished===!0&&this.$(".list-finished").remove(),this.collection.add(e)}});return o}),define("zenjs/util/number",[],function(){var e={makeRandomString:function(e){var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";e=e||10;for(var n=0;e>n;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t}};return e}),define("bower_components/pop/pop",["require","zenjs/events","zenjs/util/number"],function(e){var t=function(){},i=e("zenjs/events"),n=e("zenjs/util/number");window.zenjs=window.zenjs||{};var o=i.extend({init:function(e){this._window=$(window);var i=n.makeRandomString();$("body").append('<div id="'+i+'"                 style="display:none; height: 100%;                 position: fixed; top: 0; left: 0; right: 0;                background-color: rgba(0, 0, 0, '+(e.transparent||".9")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+i),this.nBg.on("click",$.proxy(function(){this.isCanNotHide||this.hide()},this));var o=n.makeRandomString();$("body").append('<div id="'+o+'" class="'+(e.className||"")+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+o),this.nPopContainer.hide(),this.nPopContainer.css({opacity:0,position:"absolute","z-index":1e3}),e.contentViewClass&&(this.contentViewClass=e.contentViewClass,this.contentViewOptions=$.extend({el:this.nPopContainer},e.contentViewOptions||{}),this.contentView=new this.contentViewClass($.extend({onHide:$.proxy(this.hide,this)},this.contentViewOptions)),this.contentView.onHide=$.proxy(this.hide,this)),this.animationTime=e.animationTime||300,this.isCanNotHide=e.isCanNotHide,this.doNotRemoveOnHide=e.doNotRemoveOnHide||!1,this.onShow=e.onShow||t,this.onHide=e.onHide||t,this.onFinishHide=e.onFinishHide||t,this.html=e.html},render:function(e){return this.renderOptions=e||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){return this.nBg.show().css({opacity:"1","transition-property":"none"}),this.nPopContainer.show(),this.trigger("pop:show:before"),setTimeout($.proxy(function(){this.trigger("pop:show:after"),this.nPopContainer.show().css("visibility","visible"),this._doShow&&this._doShow(),this.onShow()},this),200),this},hide:function(e){e=e||{};var t=e.doNotRemove||this.doNotRemoveOnHide||!1;this._doHide&&this._doHide(),this.trigger("pop:hide:before"),setTimeout($.proxy(function(){this.nBg.css({opacity:0,"transition-property":"opacity"}),this.trigger("pop:hide:after"),setTimeout($.proxy(function(){this.nBg.hide(),this.nPopContainer.hide(),t||this.destroy()},this),200)},this),this.animationTime),this.onHide()},destroy:function(){return this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this}});return o}),define("bower_components/pop/pop_forbid_scroll",["require","./pop"],function(e){window.zenjs=window.zenjs||{};var t=e("./pop"),i=t.extend({init:function(e){this._super(e),this.on("pop:show:before",$.proxy(this.onBeforePopShow,this)),this.on("pop:show:after",$.proxy(this.onAfterPopShow,this)),this.on("pop:hide:after",$.proxy(this.onAfterPopHide,this))},onBeforePopShow:function(){this.top=this._window.scrollTop()},onAfterPopShow:function(){this._window.scrollTop(0),this.startShow()},onAfterPopHide:function(){var e,t=function(i){return e!==this._window.scrollTop()&&i>0?(this._window.scrollTop(e),void setTimeout($.proxy(t,this,i-1))):void setTimeout($.proxy(this.onFinishHide,this),50)};return function(){this.startHide(),e=this.top,this._window.scrollTop(e),$.proxy(t,this)(2),setTimeout($.proxy(function(){window.zenjs.popList.length<1&&$("html").css("position",this.htmlPosition)},this),200)}}(),startShow:function(){var e=window.zenjs.popList;if(e||(e=window.zenjs.popList=[]),0===e.length){var t=$("body"),i=$("html");this.htmlPosition=i.css("position"),i.css("position","relative"),this.bodyCss=(t.prop("style")||{}).cssText,this.htmlCss=(i.prop("style")||{}).cssText,$("body,html").css({overflow:"hidden",height:this._window.height()})}e.indexOf(this)<0&&e.push(this)},startHide:function(){var e=window.zenjs.popList,t=e.indexOf(this);t>-1&&e.splice(t,1),e.length<1&&($("html").attr("style",this.htmlCss||""),$("body").attr("style",this.bodyCss||""))}});return i}),define("bower_components/pop/popout",["require","./pop_forbid_scroll"],function(e){var t=e("./pop_forbid_scroll"),i=t.extend({init:function(e){e=e||{},this._super(e),this.css=$.extend({transition:"opacity ease "+this.animationTime+"ms",top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},e.css||{}),this.nPopContainer.css(this.css)},_doShow:function(){$(".js-popout-close").click($.proxy(function(e){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()},_doHide:function(e){this.nPopContainer.css({opacity:0})}});return i}),define("bower_components/pop/popout_box",["require","./popout"],function(e){var t=function(){},i=e("./popout"),n=i.extend({init:function(e){this._super(e),this._onOKClicked=e.onOKClicked||t,this._onCancelClicked=e.onCancelClicked||t,this.preventHideOnOkClicked=e.preventHideOnOkClicked||!1,this.width=e.width,this.setEventListener()},setEventListener:function(){this.nPopContainer.on("click",".js-ok",$.proxy(this.onOKClicked,this)),this.nPopContainer.on("click",".js-cancel",$.proxy(this.onCancelClicked,this))},_doShow:function(){this.boxCss={"border-radius":"4px",background:"white",width:this.width||"270px",padding:"15px"},this.nPopContainer.css(this.boxCss).addClass("popout-box"),this._super()},_doHide:function(e){this._super()},onOKClicked:function(e){this._onOKClicked(e),!this.preventHideOnOkClicked&&this.hide()},onCancelClicked:function(e){this._onCancelClicked(e),this.hide()}});return n}),define("bower_components/pop/popout_box_ios",["require","./popout_box"],function(e){var t=e("./popout_box"),i=t.extend({_doShow:function(){this.boxCss={"border-radius":"4px",background:"white",width:this.width||"290px",padding:"15px 0 0"},this.nPopContainer.css(this.boxCss).addClass("popout-box-ios"),$(".js-popout-close").click($.proxy(function(e){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()}});return i}),define("text!wap/components/receive_goods/templates/infoTips.html",[],function(){return'<div>\n	<div class="header center font-size-16">\n		延长收货时间\n	</div>\n	<div class="content c-gray-dark font-size-14">\n		<%= msg %>\n	</div>\n	<div class="action-container">\n		<button class="js-ok btn btn-block c-green font-size-16">我知道了</button>\n	</div>\n</div>'}),define("text!wap/components/receive_goods/templates/confirmTips.html",[],function(){return'<div>\n	<div class="header center font-size-16">\n		延长收货时间\n	</div>\n	<div class="content c-gray-dark font-size-14">\n		每笔订单只能延长一次收货时间，如需多次延长请联系商家。\n	</div>\n	<div class="action-container">\n		<button class="js-ok btn c-black font-size-16">确定延长</button>\n		<button class="js-cancel btn c-green font-size-16">取消</button>\n	</div>\n</div>'}),define("wap/components/receive_goods/views/extend",["require","bower_components/pop/popout_box_ios","text!wap/components/receive_goods/templates/infoTips.html","text!wap/components/receive_goods/templates/confirmTips.html"],function(e){var t=e("bower_components/pop/popout_box_ios"),i=e("text!wap/components/receive_goods/templates/infoTips.html"),n=e("text!wap/components/receive_goods/templates/confirmTips.html"),o=function(){},s={TIME_NOT_ENOUGH:10030,ALREADY_EXTENDED:10031},r=function(e){var t=new $.Deferred;return $._ajax({url:"/v2/trade/order/isAllowLaterReceiveTime.json",type:"GET",dataType:"json",data:e}).done(function(i){var n=+i.code;return 0===n?void a(e,i.data,t):(t.reject(),n===s.TIME_NOT_ENOUGH||n===s.ALREADY_EXTENDED?void c(i.msg,n,i):void motify.log(i.msg))}),t.promise()},a=function(e,i,o){new t({isCanNotHide:!0,html:_.template(n)(),onOKClicked:function(){$._ajax({url:"/v2/trade/order/laterReceiveTime.json",type:"GET",dataType:"json",data:e}).done(function(e){var t=+e.code;return 0===t?void c(e.msg,t,e,function(){o.resolve()}):(o.reject(),void motify.log(e.msg))})}}).render().show()},c=function(e,n,s,r){r=r||o,new t({isCanNotHide:!0,html:_.template(i)({msg:e}),onOKClicked:r}).render().show()};return r}),define("text!wap/components/receive_goods/templates/confirmReceiveTips.html",[],function(){return'<div>\n	<div class="header center font-size-16">\n		确认收货\n	</div>\n	<div class="content c-gray-dark font-size-14">\n		确认收货后，订单交易完成，钱款将立即到达商家账户。\n	</div>\n	<div class="action-container">\n		<button class="js-ok btn c-green font-size-16">确认收货</button>\n		<button class="js-cancel btn c-black font-size-16">取消</button>\n	</div>\n</div>'}),define("wap/components/receive_goods/views/confirm",["require","bower_components/pop/popout_box_ios","text!wap/components/receive_goods/templates/confirmReceiveTips.html"],function(e){var t=e("bower_components/pop/popout_box_ios"),i=e("text!wap/components/receive_goods/templates/confirmReceiveTips.html"),n=function(e){var n=new $.Deferred;return new t({isCanNotHide:!0,html:_.template(i)(),onOKClicked:function(){$._ajax({url:"/v2/trade/order/confirmReceive.json",type:"GET",dataType:"json",data:e}).done(function(e){var t=+e.code;return 0===t?(motify.log("收货成功"),void n.resolve(e.data||{})):(n.reject(),void motify.log(e.msg))})}}).render().show(),n.promise()};return n}),define("wap/components/receive_goods/index",["require","wap/components/receive_goods/views/extend","wap/components/receive_goods/views/confirm"],function(e){var t=e("wap/components/receive_goods/views/extend"),i=e("wap/components/receive_goods/views/confirm");return{extend:t,confirm:i}}),define("wap/components/order_list/configs/order",[],function(){var e={btnHtmlList:{topay:'<a class="btn btn-primary btn-in-order-list" href="<%= detail_url %>">付款</a>',transport:'<a class="btn btn-default btn-in-order-list" href="<%= detail_url %>">物流</a>',review:'<a class="btn btn-default btn-in-order-list" href="<%= review_url %>"><%= has_all_reviewed ? "查看评价" : "评价" %></a>',peerpay:'<% if(typeof peerpay_url !== "undefined"){ %><a class="btn btn-default btn-in-order-list" href="<%= peerpay_url %>">代付</a><% } %>',gift:'<% if(typeof gift_url !== "undefined"){ %><a class="btn btn-default btn-in-order-list" href="<%= gift_url %>">礼单</a><% } %>',"extend-receive":'<a class="js-extend-receive btn btn-default btn-in-order-list" href="#" data-orderno="<%= order_no %>" data-kdtid="<%= kdt_id %>">延长收货</a>',"confirm-receive":'<a class="js-confirm-receive btn btn-default btn-in-order-list" href="#" data-orderno="<%= order_no %>" data-kdtid="<%= kdt_id %>">确认收货</a>',cancel:'<a class="js-cancel-order btn btn-default btn-in-order-list" href="javascript:;">取消</a>',"cancel-pay-on-delivery":'<a class="js-cancel-order-pod btn btn-default btn-in-order-list" href="javascript:;">取消</a>'},btnTypeList:{topay:["cancel","topay"],totuan:[],tosend:[],send:["transport"],sign:["transport"],cancel:[],complain:[],peerpay:["peerpay"],gift:["gift"],cashier_sign:[]}};return e}),define("text!wap/components/order_list/templates/order_cancel_pod.html",[],function(){return'<div class="content cancel-order">商家可能已经接单配货，您需联系客服申请取消订单哟~</div>\n<div class="action-container">\n      <div class="btn c-green js-ok btn-block">我知道了</div>\n</div>\n'}),define("text!wap/components/order_list/templates/order_cancel.html",[],function(){return'<div class="content center">订单还未付款，确定要取消吗？</div>\n<div class="action-container">\n    <div class="btn cancel-order js-ok">取消订单</div>\n    <div class="btn cancel-order c-green js-cancel">再考虑下</div>\n</div>\n'}),define("wap/components/order_list/views/order_item",["require","wap/components/receive_goods/index","../configs/order","bower_components/pop/popout_box_ios","text!wap/components/order_list/templates/order_cancel_pod.html","text!wap/components/order_list/templates/order_cancel.html"],function(e){var t=e("wap/components/receive_goods/index"),i=e("../configs/order"),n=e("bower_components/pop/popout_box_ios"),o=e("text!wap/components/order_list/templates/order_cancel_pod.html"),s=e("text!wap/components/order_list/templates/order_cancel.html");return Backbone.View.extend({tagName:"li",className:"js-block-order block block-order animated",initialize:function(e){e=e||{},this.template=_.template(e.orderItemTpl||""),this.isAllStateList=e.isAllStateList||!1,_.bindAll(this,"getOptBtns"),this.ORDER_MAP=e.ORDER_MAP||i},events:{"click .js-cancel-order":"onCancelOrderClicked","click .js-cancel-order-pod":"onCancelOrderPODClicked","click .js-toggle-more":"onToggleMore","click .js-extend-receive":"onExtendReceiveClicked","click .js-confirm-receive":"onConfirmReceiveClicked"},render:function(){var e=function(e){return e&&e.items&&e.items.length>0?e.items[0]||{}:{}};return function(){var t=this.model.toJSON(),i=e(t),n=i.goods_info||{};return this.$el.html(this.template({data:t,first_item:i,items_num:(t.items||[]).length,goods_info:n,getCdnImageUrl:window.Utils.getCdnImageUrl,order_state:this.model.get("order_state"),getEllipsis:function(e,t){return!e||e.length<=t?e:e.substring(0,t-2)+"..."},getHomePageUrl:function(e){return window._global.url.wap+"/showcase/homepage?kdt_id="+e},getOptBtns:this.getOptBtns})),this}}(),onExtendReceiveClicked:function(e){var i=$(e.target),n=i.data("orderno"),o=i.data("kdtid");t.extend({order_no:n,kdt_id:o})},onConfirmReceiveClicked:function(e){var i=this,n=$(e.target),o=n.data("orderno"),s=n.data("kdtid");t.confirm({order_no:o,kdt_id:s}).done(function(e){return motify.log("收货成功"),i.isAllStateList?(i.model.set("order_state",e.order_state),i.model.set("isAllowLaterReceive",e.isAllowLaterReceive),i.model.set("isAllowConfirmReceive",e.isAllowConfirmReceive),i.model.set("is_show_review",e.is_show_review),void i.render()):void i.model.trigger("destroy",i.model,i.model.collection)})},onCancelOrderPODClicked:function(){new n({html:o}).render().show()},onCancelOrderClicked:function(){var e=this,t=new n({preventHideOnOkClicked:!0,html:s,onOKClicked:function(){var i=e.cancelOrder();i&&i.done(function(){t.hide()})}}).render().show()},cancelOrder:function(e){var t=!1;return function(){if(t)return void motify.log("取消订单中，请勿重复操作。");var e=this;return $._ajax({url:"/v2/trade/order/cancel.json?kdt_id="+this.model.get("kdt_id"),type:"POST",dataType:"json",cache:!1,data:{order_no:e.model.get("order_no"),kdt_id:e.model.get("kdt_id")},beforeSend:function(){t=!0,motify.log("正在为您取消订单中...",0)},success:function(t){0===t.code?(motify.log("取消订单成功。"),e.isAllStateList?(e.model.set("order_state","cancel"),e.model.set("order_state_str","交易关闭"),e.render()):e.model.trigger("destroy",e.model,e.model.collection)):motify.log(t.msg)},error:function(e,t,i){motify.log("取消订单失败。")},complete:function(){t=!1}})}}(),onToggleMore:function(e){var t=$(e.currentTarget),i=t.find(".arrow");t.hasClass("show-all-text")?(t.removeClass("show-all-text"),i.removeClass("arrow-down")):(t.addClass("show-all-text"),i.addClass("arrow-down"))},getOrderTypeStr:function(){var e=this.model.get("order_state");return this.model.get("peerpay_url")&&(e="peerpay"),this.model.get("gift_url")&&(e="gift"),["6","7","8","51","52"].indexOf(this.model.get("order_type"))>-1&&(e="cashier_sign"),e},getOptBtns:function(){var e="",t=this,i=this.getOrderTypeStr(),n=1==this.model.get("is_show_review"),o=this.ORDER_MAP.btnTypeList[i].slice();return n&&o.push("review"),9==this.model.get("buy_way")&&"tosend"==i&&o.push("cancel-pay-on-delivery"),1==this.model.get("isAllowLaterReceive")&&o.push("extend-receive"),1==this.model.get("isAllowConfirmReceive")&&o.push("confirm-receive"),_.each(o,function(i){e+=t.getBtnHtml(i)}),e},getBtnHtml:function(e){var t=this.getBtnTemplate(e);return t({detail_url:this.model.get("detail_url"),peerpay_url:this.model.get("peerpay_url"),gift_url:this.model.get("gift_url"),review_url:window._global.url.wap+"/trade/reviews/readyReviewsList?order_no="+this.model.get("order_no")+"&kdt_id="+this.model.get("kdt_id"),has_all_reviewed:this.model.get("has_all_reviewed"),order_no:this.model.get("order_no"),kdt_id:this.model.get("kdt_id")})},getBtnTemplate:function(){var e={};return function(t){return e[t]||(e[t]=_.template(this.ORDER_MAP.btnHtmlList[t])),e[t]}}()})}),define("wap/components/order_list/collections/order_list",[],function(){return Backbone.Collection.extend({model:Backbone.Model,url:function(){return this.fetchUrl},initialize:function(e){this.fetchUrl=e.url||""},parse:function(e){var t=(e||{}).data||{},i=t.list||[];return i}})}),define("text!wap/components/order_list/templates/empty_order.html",[],function(){return'<div class="empty-list" style="padding-top:60px;" class="">\n    <!-- 文本 -->\n    <div>\n        <h4>居然还没有订单</h4>\n        <p class="font-size-12">好东西，手慢无</p>\n    </div>\n    <!-- 自定义html，和上面的可以并存 -->\n    <div><a href="<%= homepage %>" class="tag tag-big tag-orange" style="padding:8px 30px;">去逛逛</a></div>\n</div>'}),define("text!wap/components/order_list/templates/order_item.html",[],function(){return'<div class="header">\n    <div>\n        <a href="<%= getHomePageUrl(data.kdt_id) %>"><span class="font-size-14">店铺：<%= data.team_name %></span></a>\n        <a class="order-state-str pull-right font-size-14" href="javascript:;"><%= data.order_state_str %></a>\n    </div>\n    <div class="order-no font-size-12">订单编号：<%= data.order_no %></div>\n</div>\n<a class="name-card name-card-3col clearfix" href="<%= data.detail_url %>">\n    <div class="thumb">\n        <img src="<%= getCdnImageUrl(goods_info.img_url, \'!200x0.jpg\') %>">\n    </div>\n    <div class="detail">\n        <h3 class="font-size-14 l2-ellipsis"><%= getEllipsis(goods_info.title, 29) %></h3>\n        <% if((first_item.sku || []).length) { %>\n            <p class="sku-detail ellipsis js-toggle-more">\n                <span class="c-gray-darker">\n                    <% var sku = first_item.sku %>\n                    <% var len = 0 %>\n                    <% for(gm in sku){ %>\n                        <% if(sku[gm].v && sku[gm].v.length>0){ %><%= sku[gm].v %>&nbsp;<% } %>\n                        <% len += sku[gm].v.length %>\n                    <% } %>\n                </span>\n                <% if(len > 20) {%>\n                    <span class="js-arrow-down arrow"></span>\n                <% } %>\n            </p>\n        <% } %>\n        <% if (data.order_type_str) { %>\n            <p class="order-types">\n                <button class="btn-order-type btn"><%= data.order_type_str %></button>\n            </p>\n        <% } %>\n    </div>\n    <div class="right-col">\n        <% if (data.is_points) { %>\n            <div class="price c-black"><span><%= goods_info.points_price %></span>积分</div>\n        <% } else { %>\n            <div class="price c-black">￥<span><%= first_item.pay_price %></span></div>\n        <% } %>\n        <div class="num c-gray-darker">\n            ×<span class="num-txt c-gray-darker"><%= first_item.num %></span>\n        </div>\n    </div>\n</a>\n<% if(items_num>1) { %>\n    <a class="order-more center font-size-14" href="<%= data.detail_url %>">\n        查看全部<%= items_num %>件商品\n    </a>\n    <hr class="margin-0" />\n<% } %>\n<div class="bottom">\n    合计：\n    <% if (data.is_points) { %>\n        <span class="total-price"><%= data.real_point_pay %>积分</span>\n    <% } else { %>\n        <span class="total-price">￥<%= data.real_pay %></span>\n    <% } %>\n    \n    <div class="opt-btn pull-right">\n        <%= getOptBtns() %>\n    </div>\n</div>\n'}),window.Utils=window.Utils||{},$.extend(window.Utils,{getCdnImageUrl:function(e,t){if(!e)return window._global.url.cdn_static+"/image/wap/no_pic.png";if(t=e.match(/.+\!\d+x\d+.+/)?"":t&&t.length>0?t:"!100x100.jpg",e.match(/^(https?:)?\/\//i)){for(var i=[/^(https?:)?\/\/imgqn.koudaitong.com/,/^(https?:)?\/\/kdt-img.koudaitong.com/,/^(https?:)?\/\/img.yzcdn.cn/,/^(https?:)?\/\/dn-kdt-img.qbox.me/],n=0;n<i.length;n++)e=e.replace(i[n],window._global.url.imgqn);return e+t}return window._global.url.imgqn+"/"+e+t}}),define("wap/components/util/kdt",function(){}),define("wap/components/order_list/index",["require","bower_components/waterfall/waterfall","./views/order_item","./collections/order_list","text!./templates/empty_order.html","text!./templates/order_item.html","wap/components/util/kdt"],function(e){var t=e("bower_components/waterfall/waterfall"),i=e("./views/order_item"),n=e("./collections/order_list"),o=e("text!./templates/empty_order.html"),s=e("text!./templates/order_item.html");e("wap/components/util/kdt");var r=Backbone.View.extend({initialize:function(e){e=e||{},this.OrderItemView=e.OrderItemView||i,this.OrderListCollection=e.OrderListCollection||n,this.emptyOrderTemplate=_.template(e.emptyOrderTpl||o),this.orderItemTpl=e.orderItemTpl||s,this.ORDER_MAP=e.ORDER_MAP,this.postData=e.postData||{},this.fetchUrl=e.fetchUrl||"/v2/trade/order/list.json",this.order_state=e.order_state||"",this.isAllStateList="all"==this.order_state||""==this.order_state,this.render()},render:function(){var e=$.extend({},this.postData,{type:this.order_state});this.waterfall=new t({el:this.$el,perPage:20,itemView:this.OrderItemView,checkSize:!1,postData:e,collection:new this.OrderListCollection([],{url:this.fetchUrl}),finishedText:this.getFinishedText(),itemOptions:{isAllStateList:this.isAllStateList,orderItemTpl:this.orderItemTpl,ORDER_MAP:this.ORDER_MAP},emptyHTML:this.getEmptyHtml()}).fetchRender()},getEmptyHtml:function(){var e="";return e=window._global.kdt_id>0?window._global.url.wap+"/showcase/homepage?kdt_id="+window._global.kdt_id:"http://maijia.koudaitong.com",this.emptyOrderTemplate({homepage:e})},getFinishedText:function(){return"( ⊙ o ⊙ )啊哦，没有更多订单啦~"}});return r}),define("bower_components/aes/aes",["require","exports","module"],function(e,t,i){var n=n||function(e,t){var i={},n=i.lib={},o=function(){},s=n.Base={extend:function(e){o.prototype=this;var t=new o;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},r=n.WordArray=s.extend({init:function(e,i){e=this.words=e||[],this.sigBytes=i!=t?i:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){
var t=this.words,i=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var o=0;e>o;o++)t[n+o>>>2]|=(i[o>>>2]>>>24-8*(o%4)&255)<<24-8*((n+o)%4);else if(65535<i.length)for(o=0;e>o;o+=4)t[n+o>>>2]=i[o>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-8*(i%4),t.length=e.ceil(i/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i=[],n=0;t>n;n+=4)i.push(4294967296*e.random()|0);return new r.init(i,t)}}),a=i.enc={},c=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;e>n;n++){var o=t[n>>>2]>>>24-8*(n%4)&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;t>n;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-4*(n%8);return new r.init(i,t/2)}},l=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;e>n;n++)i.push(String.fromCharCode(t[n>>>2]>>>24-8*(n%4)&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;t>n;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-8*(n%4);return new r.init(i,t)}},d=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},h=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,n=i.words,o=i.sigBytes,s=this.blockSize,a=o/(4*s),a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0);if(t=a*s,o=e.min(4*t,o),t){for(var c=0;t>c;c+=s)this._doProcessBlock(n,c);c=n.splice(0,t),i.sigBytes-=o}return new r.init(c,o)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=h.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new p.HMAC.init(e,i).finalize(t)}}});var p=i.algo={};return i}(Math);!function(){var e=n,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,i=e.sigBytes,n=this._map;e.clamp(),e=[];for(var o=0;i>o;o+=3)for(var s=(t[o>>>2]>>>24-8*(o%4)&255)<<16|(t[o+1>>>2]>>>24-8*((o+1)%4)&255)<<8|t[o+2>>>2]>>>24-8*((o+2)%4)&255,r=0;4>r&&i>o+.75*r;r++)e.push(n.charAt(s>>>6*(3-r)&63));if(t=n.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var i=e.length,n=this._map,o=n.charAt(64);o&&(o=e.indexOf(o),-1!=o&&(i=o));for(var o=[],s=0,r=0;i>r;r++)if(r%4){var a=n.indexOf(e.charAt(r-1))<<2*(r%4),c=n.indexOf(e.charAt(r))>>>6-2*(r%4);o[s>>>2]|=(a|c)<<24-8*(s%4),s++}return t.create(o,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,i,n,o,s,r){return e=e+(t&i|~t&n)+o+r,(e<<s|e>>>32-s)+t}function i(e,t,i,n,o,s,r){return e=e+(t&n|i&~n)+o+r,(e<<s|e>>>32-s)+t}function o(e,t,i,n,o,s,r){return e=e+(t^i^n)+o+r,(e<<s|e>>>32-s)+t}function s(e,t,i,n,o,s,r){return e=e+(i^(t|~n))+o+r,(e<<s|e>>>32-s)+t}for(var r=n,a=r.lib,c=a.WordArray,l=a.Hasher,a=r.algo,d=[],h=0;64>h;h++)d[h]=4294967296*e.abs(e.sin(h+1))|0;a=a.MD5=l.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,n){for(var r=0;16>r;r++){var a=n+r,c=e[a];e[a]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var r=this._hash.words,a=e[n+0],c=e[n+1],l=e[n+2],h=e[n+3],p=e[n+4],u=e[n+5],f=e[n+6],m=e[n+7],g=e[n+8],v=e[n+9],w=e[n+10],_=e[n+11],y=e[n+12],b=e[n+13],x=e[n+14],k=e[n+15],C=r[0],F=r[1],j=r[2],z=r[3],C=t(C,F,j,z,a,7,d[0]),z=t(z,C,F,j,c,12,d[1]),j=t(j,z,C,F,l,17,d[2]),F=t(F,j,z,C,h,22,d[3]),C=t(C,F,j,z,p,7,d[4]),z=t(z,C,F,j,u,12,d[5]),j=t(j,z,C,F,f,17,d[6]),F=t(F,j,z,C,m,22,d[7]),C=t(C,F,j,z,g,7,d[8]),z=t(z,C,F,j,v,12,d[9]),j=t(j,z,C,F,w,17,d[10]),F=t(F,j,z,C,_,22,d[11]),C=t(C,F,j,z,y,7,d[12]),z=t(z,C,F,j,b,12,d[13]),j=t(j,z,C,F,x,17,d[14]),F=t(F,j,z,C,k,22,d[15]),C=i(C,F,j,z,c,5,d[16]),z=i(z,C,F,j,f,9,d[17]),j=i(j,z,C,F,_,14,d[18]),F=i(F,j,z,C,a,20,d[19]),C=i(C,F,j,z,u,5,d[20]),z=i(z,C,F,j,w,9,d[21]),j=i(j,z,C,F,k,14,d[22]),F=i(F,j,z,C,p,20,d[23]),C=i(C,F,j,z,v,5,d[24]),z=i(z,C,F,j,x,9,d[25]),j=i(j,z,C,F,h,14,d[26]),F=i(F,j,z,C,g,20,d[27]),C=i(C,F,j,z,b,5,d[28]),z=i(z,C,F,j,l,9,d[29]),j=i(j,z,C,F,m,14,d[30]),F=i(F,j,z,C,y,20,d[31]),C=o(C,F,j,z,u,4,d[32]),z=o(z,C,F,j,g,11,d[33]),j=o(j,z,C,F,_,16,d[34]),F=o(F,j,z,C,x,23,d[35]),C=o(C,F,j,z,c,4,d[36]),z=o(z,C,F,j,p,11,d[37]),j=o(j,z,C,F,m,16,d[38]),F=o(F,j,z,C,w,23,d[39]),C=o(C,F,j,z,b,4,d[40]),z=o(z,C,F,j,a,11,d[41]),j=o(j,z,C,F,h,16,d[42]),F=o(F,j,z,C,f,23,d[43]),C=o(C,F,j,z,v,4,d[44]),z=o(z,C,F,j,y,11,d[45]),j=o(j,z,C,F,k,16,d[46]),F=o(F,j,z,C,l,23,d[47]),C=s(C,F,j,z,a,6,d[48]),z=s(z,C,F,j,m,10,d[49]),j=s(j,z,C,F,x,15,d[50]),F=s(F,j,z,C,u,21,d[51]),C=s(C,F,j,z,y,6,d[52]),z=s(z,C,F,j,h,10,d[53]),j=s(j,z,C,F,w,15,d[54]),F=s(F,j,z,C,c,21,d[55]),C=s(C,F,j,z,g,6,d[56]),z=s(z,C,F,j,k,10,d[57]),j=s(j,z,C,F,f,15,d[58]),F=s(F,j,z,C,b,21,d[59]),C=s(C,F,j,z,p,6,d[60]),z=s(z,C,F,j,_,10,d[61]),j=s(j,z,C,F,l,15,d[62]),F=s(F,j,z,C,v,21,d[63]);r[0]=r[0]+C|0,r[1]=r[1]+F|0,r[2]=r[2]+j|0,r[3]=r[3]+z|0},_doFinalize:function(){var t=this._data,i=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;i[o>>>5]|=128<<24-o%32;var s=e.floor(n/4294967296);for(i[(o+64>>>9<<4)+15]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),i[(o+64>>>9<<4)+14]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(i.length+1),this._process(),t=this._hash,i=t.words,n=0;4>n;n++)o=i[n],i[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),r.MD5=l._createHelper(a),r.HmacMD5=l._createHmacHelper(a)}(Math),function(){var e=n,t=e.lib,i=t.Base,o=t.WordArray,t=e.algo,s=t.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var i=this.cfg,n=i.hasher.create(),s=o.create(),r=s.words,a=i.keySize,i=i.iterations;r.length<a;){c&&n.update(c);var c=n.update(e).finalize(t);n.reset();for(var l=1;i>l;l++)c=n.finalize(c),n.reset();s.concat(c)}return s.sigBytes=4*a,s}});e.EvpKDF=function(e,t,i){return s.create(i).compute(e,t)}}(),n.lib.Cipher||function(e){var t=n,i=t.lib,o=i.Base,s=i.WordArray,r=i.BufferedBlockAlgorithm,a=t.enc.Base64,c=t.algo.EvpKDF,l=i.Cipher=r.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,i){this.cfg=this.cfg.extend(i),this._xformMode=e,this._key=t,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,i,n){return("string"==typeof i?m:f).encrypt(e,t,i,n)},decrypt:function(t,i,n){return("string"==typeof i?m:f).decrypt(e,t,i,n)}}}});i.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=t.mode={},h=function(t,i,n){var o=this._iv;o?this._iv=e:o=this._prevBlock;for(var s=0;n>s;s++)t[i+s]^=o[s]},p=(i.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();p.Encryptor=p.extend({processBlock:function(e,t){var i=this._cipher,n=i.blockSize;h.call(this,e,t,n),i.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),p.Decryptor=p.extend({processBlock:function(e,t){var i=this._cipher,n=i.blockSize,o=e.slice(t,t+n);i.decryptBlock(e,t),h.call(this,e,t,n),this._prevBlock=o}}),d=d.CBC=p,p=(t.pad={}).Pkcs7={pad:function(e,t){for(var i=4*t,i=i-e.sigBytes%i,n=i<<24|i<<16|i<<8|i,o=[],r=0;i>r;r+=4)o.push(n);i=s.create(o,i),e.concat(i)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},i.BlockCipher=l.extend({cfg:l.cfg.extend({mode:d,padding:p}),reset:function(){l.reset.call(this);var e=this.cfg,t=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var i=e.createEncryptor;else i=e.createDecryptor,this._minBufferSize=1;this._mode=i.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var u=i.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),d=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return e=e.salt,(e?s.create([1398893684,1701076831]).concat(e).concat(t):t).toString(a)},parse:function(e){e=a.parse(e);var t=e.words;if(1398893684==t[0]&&1701076831==t[1]){var i=s.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return u.create({ciphertext:e,salt:i})}},f=i.SerializableCipher=o.extend({cfg:o.extend({format:d}),encrypt:function(e,t,i,n){n=this.cfg.extend(n);var o=e.createEncryptor(i,n);return t=o.finalize(t),o=o.cfg,u.create({ciphertext:t,key:i,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,i,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(i,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,i,n){return n||(n=s.random(8)),e=c.create({keySize:t+i}).compute(e,n),i=s.create(e.words.slice(t),4*i),e.sigBytes=4*t,u.create({key:e,iv:i,salt:n})}},m=i.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:t}),encrypt:function(e,t,i,n){return n=this.cfg.extend(n),i=n.kdf.execute(i,e.keySize,e.ivSize),n.iv=i.iv,e=f.encrypt.call(this,e,t,i.key,n),e.mixIn(i),e},decrypt:function(e,t,i,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),i=n.kdf.execute(i,e.keySize,e.ivSize,t.salt),n.iv=i.iv,f.decrypt.call(this,e,t,i.key,n)}})}(),function(){for(var e=n,t=e.lib.BlockCipher,i=e.algo,o=[],s=[],r=[],a=[],c=[],l=[],d=[],h=[],p=[],u=[],f=[],m=0;256>m;m++)f[m]=128>m?m<<1:m<<1^283;for(var g=0,v=0,m=0;256>m;m++){var w=v^v<<1^v<<2^v<<3^v<<4,w=w>>>8^255&w^99;o[g]=w,s[w]=g;var _=f[g],y=f[_],b=f[y],x=257*f[w]^16843008*w;r[g]=x<<24|x>>>8,a[g]=x<<16|x>>>16,c[g]=x<<8|x>>>24,l[g]=x,x=16843009*b^65537*y^257*_^16843008*g,d[w]=x<<24|x>>>8,h[w]=x<<16|x>>>16,p[w]=x<<8|x>>>24,u[w]=x,g?(g=_^f[f[f[b^_]]],v^=f[f[v]]):g=v=1}var k=[0,1,2,4,8,16,32,64,128,27,54],i=i.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,i=e.sigBytes/4,e=4*((this._nRounds=i+6)+1),n=this._keySchedule=[],s=0;e>s;s++)if(i>s)n[s]=t[s];else{var r=n[s-1];s%i?i>6&&4==s%i&&(r=o[r>>>24]<<24|o[r>>>16&255]<<16|o[r>>>8&255]<<8|o[255&r]):(r=r<<8|r>>>24,r=o[r>>>24]<<24|o[r>>>16&255]<<16|o[r>>>8&255]<<8|o[255&r],r^=k[s/i|0]<<24),n[s]=n[s-i]^r}for(t=this._invKeySchedule=[],i=0;e>i;i++)s=e-i,r=i%4?n[s]:n[s-4],t[i]=4>i||4>=s?r:d[o[r>>>24]]^h[o[r>>>16&255]]^p[o[r>>>8&255]]^u[o[255&r]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,r,a,c,l,o)},decryptBlock:function(e,t){var i=e[t+1];e[t+1]=e[t+3],e[t+3]=i,this._doCryptBlock(e,t,this._invKeySchedule,d,h,p,u,s),i=e[t+1],e[t+1]=e[t+3],e[t+3]=i},_doCryptBlock:function(e,t,i,n,o,s,r,a){for(var c=this._nRounds,l=e[t]^i[0],d=e[t+1]^i[1],h=e[t+2]^i[2],p=e[t+3]^i[3],u=4,f=1;c>f;f++)var m=n[l>>>24]^o[d>>>16&255]^s[h>>>8&255]^r[255&p]^i[u++],g=n[d>>>24]^o[h>>>16&255]^s[p>>>8&255]^r[255&l]^i[u++],v=n[h>>>24]^o[p>>>16&255]^s[l>>>8&255]^r[255&d]^i[u++],p=n[p>>>24]^o[l>>>16&255]^s[d>>>8&255]^r[255&h]^i[u++],l=m,d=g,h=v;m=(a[l>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&p])^i[u++],g=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[p>>>8&255]<<8|a[255&l])^i[u++],v=(a[h>>>24]<<24|a[p>>>16&255]<<16|a[l>>>8&255]<<8|a[255&d])^i[u++],p=(a[p>>>24]<<24|a[l>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^i[u++],e[t]=m,e[t+1]=g,e[t+2]=v,e[t+3]=p},keySize:8});e.AES=t._createHelper(i)}(),n.pad.Iso10126={pad:function(e,t){var i=4*t,i=i-e.sigBytes%i;e.concat(n.lib.WordArray.random(i-1)).concat(n.lib.WordArray.create([i<<24],1))},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},i.exports=n}),define("bower_components/aes/main",["require","./aes"],function(e){var t=e("./aes"),i=t.enc.Utf8.parse("youzan.com.aesiv"),n=t.enc.Utf8.parse("youzan.com._key_");return{encrypt:function(e){return e=t.enc.Utf8.parse(e),t.AES.encrypt(e,n,{mode:t.mode.CBC,padding:t.pad.Iso10126,iv:i}).toString()}}}),define("text!bower_components/login/templates/init.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2>请填写您的手机号码</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="" value="<%= phone %>">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <input type="submit" class="js-confirm btn btn-green btn-block font-size-14" value="确认手机号码" />\n    </div>\n</form>\n'}),define("text!bower_components/login/templates/login.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2>该号码注册过，请直接登录</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="请输入你的手机号" disabled="disabled" value="<%= phone %>">\n        </div>\n        <div class="form-item">\n            <label for="password">密码</label>\n            <input id="passsword" name="password"  type="password" autocomplete="off" placeholder="请输入登录密码">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <button type="button" class="js-confirm btn btn-green btn-block font-size-14">\n            <%= showBindText ? \'登录并绑定\' : \'确认\' %>\n        </button>\n    </div>\n    <div class="bottom-tips font-size-12">\n        <span class="c-orange">如果您忘了密码，请</span><a href="javascript:;" class="js-change-pwd c-blue">点此找回密码</a>\n        <a href="javascript:;" class="js-change-phone c-blue pull-right">更换手机号</a>\n    </div>\n</form>\n'}),define("text!bower_components/login/templates/register.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2>注册有赞帐号</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="请输入你的手机号" disabled="disabled" value="<%= phone %>">\n        </div>\n        <div class="form-item js-image-verify hide">\n            <label for="verifycode">身份校验</label>\n            <input id="verifycode" name="verifycode" class="js-verify-code item-input"  type="tel" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入右侧数字">\n            <img class="js-verify-image verify-image" src="">\n        </div>\n        <div class="form-item">\n            <label for="code">验证码</label>\n            <input id="code" name="code"  type="text" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入短信验证码">\n            <button type="button" class="js-auth-code tag btn-auth-code tag-green font-size-12" data-text="获取验证码">\n                获取验证码\n            </button>\n        </div>\n        <div class="form-item">\n            <label for="password">密码</label>\n            <input id="passsword" name="password"  type="password" autocomplete="off" maxlength="20" placeholder="请输入8-20位数字和字母组合">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <button type="button" class="js-confirm btn btn-green btn-block font-size-14">\n            <%= showBindText ? \'注册并绑定\' : \'确认\' %>\n        </button>\n    </div>\n    <div class="bottom-tips font-size-12">\n        <span class="c-orange">如果您忘了密码，请</span><a href="javascript:;" class="js-change-pwd c-blue">点此找回密码</a>\n        <a href="javascript:;" class="js-change-phone c-blue pull-right">更换手机号</a>\n    </div>\n</form>\n'}),define("text!bower_components/login/templates/change_pwd.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2><%if(isSetting){%>设定<%}else{%>找回<%}%>帐号密码</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="请输入你的手机号" disabled="disabled" value="<%= phone %>">\n        </div>\n        <div class="form-item js-image-verify hide">\n            <label for="verifycode">身份校验</label>\n            <input id="verifycode" name="verifycode" class="js-verify-code item-input"  type="tel" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入右侧数字">\n            <img class="js-verify-image verify-image" src="">\n        </div>\n        <div class="form-item">\n            <label for="code">验证码</label>\n            <input id="code" name="code"  type="text" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入短信验证码">\n            <button type="button" class="js-auth-code tag btn-auth-code font-size-12 tag-green" data-text="获取验证码">\n                获取验证码\n            </button>\n        </div>\n        <div class="form-item">\n            <label for="password">密码</label>\n            <input id="passsword" name="password"  type="password" autocomplete="off" placeholder="设置新的8-20位数字和字母组合密码">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <button type="button" class="js-confirm btn btn-green btn-block font-size-14">确定</button>\n    </div>\n    <div class="bottom-tips pull-right">\n        <a href="javascript:;" class="js-login inline-item c-blue">已有帐号登录</a>\n        <a href="javascript:;" class="js-register inline-item c-blue">注册新帐号</a>\n    </div>\n</form>\n'}),define("zenjs/util/valid",[],function(){window.zenjs=window.zenjs||{};var e={validMobile:function(e){return e=""+e,/^((\+86)|(86))?(1)\d{10}$/.test(e)},validPhone:function(e){return e=""+e,/^0[0-9\-]{10,13}$/.test(e)},validNumber:function(e){return/^\d+$/.test(e)},validEmail:function(e){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e)},validPostalCode:function(e){return e=""+e,/^\d{6}$/.test(e)}};return window.zenjs.Valid=e,e}),window.Zepto&&function(e){e.fn.serializeArray=function(){var t,i,n=[],o=function(e){return e.forEach?e.forEach(o):void n.push({name:t,value:e})};return this[0]&&e.each(this[0].elements,function(n,s){i=s.type,t=s.name,t&&"fieldset"!=s.nodeName.toLowerCase()&&!s.disabled&&"submit"!=i&&"reset"!=i&&"button"!=i&&"file"!=i&&("radio"!=i&&"checkbox"!=i||s.checked)&&o(e(s).val())}),n},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(0 in arguments)this.bind("submit",t);else if(this.length){var i=e.Event("submit");this.eq(0).trigger(i),i.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),define("vendor/zepto/form",function(){}),define("zenjs/util/form",["require","exports","module","vendor/zepto/form","jquery"],function(e,t,i){e("vendor/zepto/form");var n=e("jquery");window.zenjs=window.zenjs||{};var o={getFormData:function(e){var t=e.serializeArray(),i={};return n.map(t,function(e){i[e.name]=e.value}),i}};window.zenjs.Form=o,i.exports=o}),define("zenjs/sms_fetch/main",["require","exports","module","bower_components/ajax/ajax","jquery"],function(e,t,i){function n(){this.loadingLock=!1,this.isUsed=void 0}function o(e){e=e||{},this.$el=s(e.el||e.$el||"<div></div>"),this.el=this.$el[0],this.$=function(e){return this.$el.find(e)},this.initialize&&this.initialize(e)}e("bower_components/ajax/ajax");var s=e("jquery"),r=function(){};n.prototype={fetch:function(){if(this.isUsed!==!1){var e=this;this.loadingLock=!0,s._ajax({url:window._global.url.www.replace(/^https?:\/\//,"//")+"/common/token/token.jsonp",type:"get",dataType:"jsonp"}).done(function(t){0==t.code?(e.token=t.data,e.loadingLock=!1,e.isUsed=!1):motify.log(t.msg)}).fail(function(){motify.log("token 获取失败")})}},get:function(){return this.isUsed=!0,this.token}};var a=new n;s.extend(o.prototype,{initialize:function(e){this.duration=e.time||60,this.step=e.step||1100,this.codeVerifyClass=e.codeVerifyClass||"js-verify-code",this.verifyType="smsFetch";var t=window._global.url.www.replace(/^https?:\/\//,"//");this.smsFetchUrl=t+"/common/sms/captcha.jsonp",this.imgUrl=t+"/common/sms/imgcaptcha",this.imgVerifyUrl=t+"/common/sms/imgcaptcha.jsonp",this.biz=e.biz||"kdt_account_captcha",this.onTimeChange=e.onTimeChange||r,this.onTimeEnd=e.onTimeEnd||r,this.onTimerStart=e.onTimerStart||r,this.onTimerClose=e.onTimerClose||r,this.onVerifyPictureShow=e.onVerifyPictureShow||r,this.onGetCodeError=e.onGetCodeError||r,this.onVerifyPictureSuccess=e.onVerifyPictureSuccess||r,this.onVerifyPictureError=e.onVerifyPictureError||r,this.platform=e.platform||"",this.subFrom=e.subFrom||"",a.fetch()},setMobile:function(e){e&&(this.mobile=e)},getImageCode:function(){return s.trim(this.$("."+this.codeVerifyClass).val())},getSms:function(e){var t=this;if(a.loadingLock)return void motify.log("数据加载中，稍后再试");if(e=e||{},e.mobile&&(this.mobile=e.mobile),!this.mobile)return!1;var i={smsFetch:t.onSmsFetchHandler,image:t.onImageHandler};return t.startTimer.call(t),(i[t.verifyType]||r).call(t),this},startTimer:function(){this.onTimerStart(),this.btnCountdown(this.duration)},stopTimer:function(){clearTimeout(this.timer),this.onTimerClose()},btnCountdown:function(e){var t=this;this.onTimeChange({second:e}),--e>=0?this.timer=setTimeout(function(){t.btnCountdown(e)},this.step):(this.onTimeEnd(),this.timer="")},onVerifyImageShow:function(e){this.$(".js-image-verify").removeClass("hide"),this.$(".js-verify-image").attr("src",e)},onVerifyImageHide:function(){this.$(".js-image-verify").addClass("hide")},onSmsFetchHandler:function(){var e=1;return function(){var t=this,i={verifyTimes:e,mobile:this.mobile,biz:this.biz,token:a.get()};this.platform&&(i.platform=this.platform),this.subFrom&&(i.sub_from=this.subFrom),s._ajax({url:this.smsFetchUrl,dataType:"jsonp",data:i,success:function(i){return 0==i.code?void e++:(t.stopTimer.call(t),t.onGetCodeError.call(t),void(10111===i.code?(t.verifyType="image",t.onVerifyImageShow(t.imgUrl),t.onVerifyPictureShow()):(e++,motify.log(i.msg))))},error:function(i,n,o){e++,t.stopTimer.call(t),t.onGetCodeError.call(t),motify.log("获取验证码失败，请稍后再试")},complete:function(e,t){}}).always(function(){a.fetch()})}}(),onImageHandler:function(){var e=this,t=this.mobile;s._ajax({url:this.imgVerifyUrl,dataType:"jsonp",data:{mobile:t,captcha_code:this.getImageCode()},success:function(i){return 0===i.code?(e.verifyType="smsFetch",e.mobile=t,e.onVerifyImageHide(),e.onVerifyPictureSuccess(),void e.onSmsFetchHandler()):(e.stopTimer.call(e),e.onVerifyPictureError.call(e),void(10100===i.code?(motify.log(i.msg),e.$el.find(".js-verify-image").attr("src",e.imgUrl)):motify.log(i.msg)))},error:function(t,i,n){e.stopTimer.call(e),e.onVerifyPictureError.call(e),motify.log("图形验证失败，重试一下吧~"),e.$el.find(".js-verify-image").attr("src",e.imgUrl)},complete:function(e,t){}})}}),i.exports=o}),define("zenjs/util/url_helper",[],function(){var e={site:function(e,t){var i=window._global.env,n=window._global.url;"static"===t&&"online"===i&&(t="cdn_static");var o=e;return t=t?n[t]||"":"",-1==e.search(/^http[s]?\:\/\//)&&("/"!==e[0]&&(e="/"+e),o=t+e),o},getCdnImageUrl:function(e,t){if(!e)return window._global.url.cdn_static+"/image/wap/no_pic.png";if(t=e.match(/.+\!\d+x\d+.+/)?"":t&&t.length>0?t:"!100x100.jpg",e.match(/^(https?:)?\/\//i)){for(var i=[/^(https?:)?\/\/imgqn.koudaitong.com/,/^(https?:)?\/\/kdt-img.koudaitong.com/,/^(https?:)?\/\/img.yzcdn.cn/,/^(https?:)?\/\/dn-kdt-img.qbox.me/],n=0;n<i.length;n++)e=e.replace(i[n],window._global.url.imgqn);return e+t}return window._global.url.imgqn+"/"+e+t}};return e}),define("bower_components/login/main",["require","bower_components/ajax/ajax","jquery","backbone","bower_components/aes/main","text!./templates/init.html","text!./templates/login.html","text!./templates/register.html","text!./templates/change_pwd.html","zenjs/util/valid","zenjs/util/form","zenjs/sms_fetch/main","zenjs/util/url_helper","zenjs/util/ua"],function(e){e("bower_components/ajax/ajax");var t=e("jquery"),i=e("backbone"),n=e("bower_components/aes/main"),o=e("text!./templates/init.html"),s=e("text!./templates/login.html"),r=e("text!./templates/register.html"),a=e("text!./templates/change_pwd.html"),c=e("zenjs/util/valid"),l=e("zenjs/util/form"),d=e("zenjs/sms_fetch/main"),h=e("zenjs/util/url_helper"),p=e("zenjs/util/ua"),u=["youzanmars"],f=i.View.extend({events:{"click .js-confirm":"onConfirmClicked","click .js-change-phone":"onChangePhoneClicked","click .js-change-pwd":"onChangePwdClicked","click .js-login":"onLoginClicked","click .js-register":"onRegisterClicked","click .js-auth-code":"onAuthcodeClicked","submit .js-login-form":"onConfirmClicked"},initialize:function(e){e=e||{};var i=p.getPlatform();if(u.indexOf(i)>-1)return void(window.location.href=h.site("/buyer/kdtunion?redirect_uri="+encodeURIComponent(window.location.href),"wap"));var n=this,c=_global.url;this.tpl_map={init:_.template(e.initTpl||o),login:_.template(e.loginTpl||s),register:_.template(e.registerTpl||r),changePwd:_.template(e.changePwdTpl||a)},this.valid_map={checkPhone:_(this.checkPhone).bind(this),checkPwd:_(this.checkPwd).bind(this),checkCode:_(this.checkCode).bind(this)},this.renderOpt=e.renderOpt||{type:"init",phone:""},this.renderOpt.showBindText=p.isWeixin()||p.isQQ(),this.urlMap={login:e.loginUrl||c.wap+"/buyer/auth/authlogin.json",register:e.registerUrl||c.wap+"/buyer/auth/authRegister.json",changePwd:e.changePwdUrl||c.wap+"/buyer/auth/changePassword.json",confirm:e.confirmUrl||c.wap+"/buyer/auth/authConfirm.json"},this.source=e.source||2,this.ajaxType=e.ajaxType||"POST",this.afterLogin=e.afterLogin||function(){};var l,f;p.isMobile()?(l="app",f="wsc",p.isWxd()?f="wxd":p.isWsc()?f="wsc":p.isPf()?f="pf":l="wap"):l="pc",this.sms=new d({el:this.$el,onTimeChange:function(e){var i=e.second;t(n.nAuthCode).text("等待 "+i+"秒")},onTimeEnd:function(){n.nAuthCode.text("再次获取"),n.nAuthCode.prop("disabled",!1),n.nAuthCode.removeClass("disabled"),n.nCodeInput.attr("placeholder","没有收到验证码？")},onTimerStart:function(){n.nAuthCode.prop("disabled",!0),n.nAuthCode.addClass("disabled")},onVerifyPictureError:function(){n.nAuthCode.removeAttr("disabled"),n.nAuthCode.removeClass("disabled"),n.nAuthCode.text("再次获取")},onGetCodeError:function(){n.nAuthCode.removeAttr("disabled"),n.nAuthCode.removeClass("disabled"),n.nAuthCode.text("再次获取")},onVerifyPictureShow:function(){n.nHelpInfo.html("操作过于频繁，请先输入图像验证码再获取")},onVerifyPictureSuccess:function(){n.nHelpInfo.html("")},platform:l,subFrom:f})},render:function(){return this.appLogined?this:(this.$el.html(this.tpl_map[this.renderOpt.type](this.renderOpt)),this.nForm=this.$(".js-login-form"),this.nHelpInfo=this.$(".js-help-info"),this.nPhone=this.$('input[name="phone"]'),this.nPwd=this.$('input[name="password"]'),this.nCodeInput=this.$('input[name="authcode"]'),this.nAuthCode=this.$(".js-auth-code"),this)},show:function(e,t){"changePwd"==e?this.sms.biz="reset_account_passwd":this.sms.biz="kdt_account_captcha",_.extend(this.renderOpt,{type:e},t||{isSetting:!1}),this.render(this.renderOpt),this.$el.show(this.animationTime)},onConfirmClicked:function(e){e.preventDefault();var i=this,o=t(e.target),s=l.getFormData(i.nForm);if(s=_.extend(i.renderOpt,s),!i.validate(s))return!1;s.source=this.source,s.password&&(s.password=n.encrypt(s.password));var r=o.html();if("init"===i.renderOpt.type)i.renderOpt.phone=s.phone,t._ajax({url:this.urlMap.confirm,type:"POST",dataType:"json",timeout:15e3,data:s,xhrFields:{withCredentials:!0},beforeSend:function(){o.html("确认中..."),o.prop("disabled",!0)},success:function(e){switch(+e.code){case 0:i.show("login");break;case 200:i.show("register");break;case 300:i.show("changePwd",{isSetting:!0});default:i.nHelpInfo.html(e.msg)}},error:function(){i.nHelpInfo.html("出错啦，请重试")},complete:function(){o.html(r),o.prop("disabled",!1)}});else{var a=i.renderOpt.type;t._ajax({url:this.urlMap[a],type:this.ajaxType,dataType:"json",timeout:15e3,data:s,xhrFields:{withCredentials:!0},beforeSend:function(){o.html("确认中..."),o.prop("disabled",!0)},success:function(e){0===e.code?i.afterLogin(e,{type:a}):i.nHelpInfo.html(e.msg)},error:function(){i.nHelpInfo.html("出错啦，请重试")},complete:function(){o.html(r),o.prop("disabled",!1)}})}},onAuthcodeClicked:function(e){e.preventDefault();var t=this,i=l.getFormData(t.nForm);i=_.extend(t.renderOpt,i);var n=i.phone;this.sms.setMobile(n),this.sms.getSms()},onChangePhoneClicked:function(e){e.preventDefault(),this.show("init")},onChangePwdClicked:function(e){e.preventDefault(),this.sms.stopTimer(),this.show("changePwd")},onLoginClicked:function(e){e.preventDefault(),this.show("init")},onRegisterClicked:function(e){e.preventDefault(),this.show("init")},validate:function(){var e={init:["checkPhone"],login:["checkPwd"],register:["checkCode","checkPwd"],changePwd:["checkCode","checkPwd"]};return function(t){return _.every(e[t.type],_(function(e){return this.valid_map[e](t)}).bind(this))}}(),checkPhone:function(e){return""===e.phone?(this.nPhone.focus(),this.nHelpInfo.html("请填写您的手机号码"),!1):c.validMobile(e.phone)?!0:(this.nPhone.focus(),this.nHelpInfo.html("请填写11位手机号码"),!1)},checkPwd:function(e){function t(e){var t=/[a-zA-Z]/g,i=/[0-9]/g,n=0,o=t.test(e),s=i.test(e);return o&&s&&(n=1),n}if(""===e.password)return this.nPwd.focus(),this.nHelpInfo.html("请输入您的密码"),!1;if("login"!==this.renderOpt.type&&e.password.length<8)return this.nPwd.focus(),this.nHelpInfo.html("亲，密码最短为8位"),!1;if("login"!==this.renderOpt.type&&e.password.length>20)return this.nPwd.focus(),this.nHelpInfo.html("亲，密码最长为20位"),!1;if("login"!==this.renderOpt.type){var i=t(e.password);if(!i)return this.nPwd.focus(),this.nHelpInfo.html("亲，密码为8-20位数字和字母组合"),
!1}return!0},checkCode:function(e){return c.validPostalCode(e.code)?!0:(this.nCodeInput.focus(),this.nHelpInfo.html("请填写6位短信验证码"),!1)}});return f}),define("text!wap/uc/order_list/template/packOrderTips.html",[],function(){return'<div class="header center">\n	<h2>已找齐所有订单？</h2>\n</div>\n<p class="content c-gray-darker">\n	系统正在逐一整理您账户下的所有购物记录，该过程可能需要持续一段较长时间，请稍后再关注购物记录。\n</p>\n<div class="action-container">\n	<span class="btn-2-1">\n		<button class="js-ok btn btn-green pull-left">我知道了</button>\n	</span>\n	<span class="btn-2-1">\n		<button class="js-cancel btn btn-white pull-right">不再提示</button>\n	</span>\n</div>'}),require(["zenjs/util/args","wap/components/order_list/index","bower_components/login/main","bower_components/pop/popout_box","text!wap/uc/order_list/template/packOrderTips.html"],function(e,t,i,n,o){var s=window._global.see_history||"",r=new t({el:$("#order-list-container"),fetchUrl:"/v2/trade/record/orderList.json",postData:{see_history:s}}),a=r.waterfall;a.on("finished",function(){if(window._global.fans_id&&window._global.isBuyerRecord&&!s){var t=e.add(location.href,{see_history:1});a.$el.append('<div class="action-container">                <a href="'+t+'" class="btn btn-block btn-white">查看更早的订单</a>            </div>')}});var c=$(".js-record-login-container"),l=$(".js-record-login-tips"),d=0,h={weixin:"bindwx",qq:"bindqq"};$("body").on("click",".js-when-ok",function(e){e.preventDefault(),clearTimeout(d);var t=new n({html:o,className:"prompt-box",onCancelClicked:function(){l.addClass("hide").css("opacity","0"),window.location.reload()},onOKClicked:function(){window.location.reload()}});t.render().show()}),$("body").on("click",".js-record-login",function(e){e.preventDefault();var t=new n({contentViewClass:i,contentViewOptions:{afterLogin:function(e){var i=e&&e.data,n=window._global;if(i&&i.ajax_confirm_bind_user_fans&&h[n.platform]&&n.url)window.location.assign(n.url.wap+"/buyer/manage/"+h[n.platform]+"?redirect_uri="+encodeURIComponent(location.href));else{if(t.hide(),c.addClass("hide"),$._ajax({url:"/v2/trade/record/merge.json",type:"GET",dataType:"json"}),window._global.migrate_state)return;d=setTimeout(function(){window.location.reload()},5e3),l.removeClass("hide").css("opacity","1")}}}});t.render().show()})}),define("main",function(){});